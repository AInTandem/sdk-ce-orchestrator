#!/bin/sh
set -e

GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'

printf "üìù Running pre-commit checks...\n"

# Get staged TypeScript/JavaScript files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx)$' || true)

if [ -z "$STAGED_FILES" ]; then
    printf "‚ÑπÔ∏è  No TypeScript/JavaScript files to check.\n"
    exit 0
fi

printf "Staged files:\n"
printf "%s\n" "$STAGED_FILES" | sed 's/^/  - /'
printf "\n"

# 1. TypeScript type check
printf "${YELLOW}‚ñ∂ Type checking staged files...${NC}\n"
if ! pnpm typecheck; then
    printf "\n"
    printf "${RED}‚ùå Type check failed!${NC}\n"
    printf "Please fix type errors before committing.\n"
    exit 1
fi
printf "${GREEN}‚úì Type check passed${NC}\n"
printf "\n"

# 2. ESLint
printf "${YELLOW}‚ñ∂ Linting staged files...${NC}\n"
if ! pnpm lint; then
    printf "\n"
    printf "${RED}‚ùå Linting failed!${NC}\n"
    printf "Please fix linting errors before committing.\n"
    exit 1
fi
printf "${GREEN}‚úì Linting passed${NC}\n"
printf "\n"

printf "${GREEN}‚úÖ Pre-commit checks passed!${NC}\n"
exit 0
